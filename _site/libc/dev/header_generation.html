<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Generating Public and Internal headers &#8212; The LLVM C Library</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=d75fae25" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css?v=2e637bd6" />
    <script src="../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Convention for implementing entrypoints" href="implementation_standard.html" />
    <link rel="prev" title="Fuzzing for LLVM-libc functions" href="fuzzing.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="generating-public-and-internal-headers">
<span id="header-generation"></span><h1>Generating Public and Internal headers<a class="headerlink" href="#generating-public-and-internal-headers" title="Link to this heading">¶</a></h1>
<p>There are 3 main components of the Headergen. The first component are the YAML
files that contain all the function header information and are separated by
header specification and standard. The second component are the classes that
are created for each component of the function header: macros, enumerations,
types, function, arguments, and objects. The third component is the Python
script that uses the class representation to deserialize YAML files into its
specific components and then reserializes the components into the function
header. The Python script also combines the generated header content with
header definitions and extra macro and type inclusions from the .h.def file.</p>
<section id="instructions">
<h2>Instructions<a class="headerlink" href="#instructions" title="Link to this heading">¶</a></h2>
<dl class="simple">
<dt>Required Versions:</dt><dd><ul class="simple">
<li><p>Python Version: 3.8</p></li>
<li><p>PyYAML Version: 5.1</p></li>
</ul>
</dd>
</dl>
<ol class="arabic simple">
<li><p>Keep full-build mode on when building, otherwise headers will not be
generated.</p></li>
<li><p>Once the build is complete, enter in the command line within the build
directory <code class="docutils literal notranslate"><span class="pre">ninja</span> <span class="pre">check-hdrgen</span></code> to ensure that the integration tests are
passing.</p></li>
<li><p>Then enter in the command line <code class="docutils literal notranslate"><span class="pre">ninja</span> <span class="pre">libc</span></code> to generate headers. Headers
will be in <code class="docutils literal notranslate"><span class="pre">build/projects/libc/include</span></code> or <code class="docutils literal notranslate"><span class="pre">build/libc/include</span></code> in a
runtime build. Sys spec headers will be located in
<code class="docutils literal notranslate"><span class="pre">build/projects/libc/include/sys</span></code>.</p></li>
</ol>
<p>To add a function to the YAML files, you can either manually enter it in the
YAML file corresponding to the header it belongs to or add it through the
command line.</p>
<p>To add through the command line:</p>
<ol class="arabic">
<li><p>Make sure you are in the llvm-project directory.</p></li>
<li><p>Enter in the command line:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>python3 libc/utils/hdrgen/yaml_to_classes.py
libc/include/[yaml_file.yaml] --add_function &quot;&lt;return_type&gt;&quot; &lt;function_name&gt; &quot;&lt;function_arg1, function_arg2&gt;&quot; &lt;standard&gt; &lt;guard&gt; &lt;attribute&gt;
</pre></div>
</div>
<p>Example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>python3 libc/utils/hdrgen/yaml_to_classes.py
libc/include/ctype.yaml --add_function &quot;char&quot; example_function
&quot;int, void, const void&quot; stdc example_float example_attribute
</pre></div>
</div>
<p>Keep in mind only the return_type and arguments have quotes around them. If
you do not have any guards or attributes you may enter “null” for both.</p>
</li>
<li><p>Check the YAML file that the added function is present. You will also get a
generated header file with the new addition in the hdrgen directory to
examine.</p></li>
</ol>
<p>If you want to sort the functions alphabetically you can check out
<code class="docutils literal notranslate"><span class="pre">libc/utils/hdrgen/hdrgen/yaml_functions_sorted.py</span></code>.</p>
</section>
<section id="testing">
<h2>Testing<a class="headerlink" href="#testing" title="Link to this heading">¶</a></h2>
<p>Headergen has an integration test that you may run once you have configured
your CMake within the build directory. In the command line, enter the
following: <code class="docutils literal notranslate"><span class="pre">ninja</span> <span class="pre">check-hdrgen</span></code>. The integration test is one test that
ensures the process of YAML to classes to generate headers works properly. If
there are any new additions on formatting headers, make sure the test is
updated with the specific addition.</p>
<p>Integration Test can be found in: <code class="docutils literal notranslate"><span class="pre">libc/utils/hdrgen/tests/test_integration.py</span></code></p>
<p>File to modify if adding something to formatting:
<code class="docutils literal notranslate"><span class="pre">libc/utils/hdrgen/tests/expected_output/test_header.h</span></code></p>
</section>
<section id="common-errors">
<h2>Common Errors<a class="headerlink" href="#common-errors" title="Link to this heading">¶</a></h2>
<ol class="arabic">
<li><p>Missing function specific component</p>
<p>Example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&quot;/llvm-project/libc/utils/hdrgen/hdrgen/yaml_to_classes.py&quot;, line 67, in yaml_to_classes function_data[&quot;return_type&quot;]
</pre></div>
</div>
<p>If you receive this error or any error pertaining to
<code class="docutils literal notranslate"><span class="pre">function_data[function_specific_component]</span></code> while building the headers
that means the function specific component is missing within the YAML files.
Through the call stack, you will be able to find the header file which has
the issue. Ensure there is no missing function specific component for that
YAML header file.</p>
</li>
<li><p>CMake Error: require argument to be specified</p>
<p>Example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>CMake Error at:
/llvm-project/libc/cmake/modules/LLVMLibCHeaderRules.cmake:86 (message):
&#39;add_gen_hdr&#39; rule requires GEN_HDR to be specified.
Call Stack (most recent call first):
/llvm-project/libc/include/CMakeLists.txt:22 (add_gen_header)
/llvm-project/libc/include/CMakeLists.txt:62 (add_header_macro)
</pre></div>
</div>
<p>If you receive this error, there is a missing YAML file, h_def file, or
header name within the <code class="docutils literal notranslate"><span class="pre">libc/include/CMakeLists.txt</span></code>. The last line in the
error call stack will point to the header where there is a specific component
missing. Ensure the correct style and required files are present:</p>
<div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">[header_name]</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">[../libc/include/[yaml_file.yaml]</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">[header_name.h]</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">DEPENDS</span></code></div>
<div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">{Necessary</span> <span class="pre">Depend</span> <span class="pre">Files}</span></code></div>
</div>
</div>
</li>
<li><p>Command line: expected arguments</p>
<p>Example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>usage: yaml_to_classes.py [-h] [--output_dir OUTPUT_DIR] [--h_def_file H_DEF_FILE]
[--add_function RETURN_TYPE NAME ARGUMENTS STANDARDS GUARD ATTRIBUTES]
[--e ENTRY_POINTS] [--export-decls]
yaml_file
yaml_to_classes.py:
error: argument --add_function: expected 6 arguments
</pre></div>
</div>
<p>In the process of adding a function, you may run into an issue where the
command line is requiring more arguments than what you currently have. Ensure
that all components of the new function are filled. Even if you do not have a
guard or attribute, make sure to put null in those two areas.</p>
</li>
<li><p>Object has no attribute</p>
<p>Example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>File &quot;/llvm-project/libc/utils/hdrgen/hdrgen/header.py&quot;, line 60, in __str__ for
function in self.functions: AttributeError: &#39;HeaderFile&#39; object has no
attribute &#39;functions&#39;
</pre></div>
</div>
<p>When running <code class="docutils literal notranslate"><span class="pre">ninja</span> <span class="pre">libc</span></code> in the build directory to generate headers you
may receive the error above. Essentially this means that in
<code class="docutils literal notranslate"><span class="pre">libc/utils/hdrgen/hdrgen/header.py</span></code> there is a missing attribute named functions.
Make sure all function components are defined within this file and there are
no missing functions to add these components.</p>
</li>
<li><p>Unknown type name</p>
<p>Example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>/llvm-project/build/projects/libc/include/sched.h:20:25: error: unknown type
name &#39;size_t&#39;; did you mean &#39;time_t&#39;?
20 | int_sched_getcpucount(size_t, const cpu_set_t*) __NOEXCEPT
 |           ^
/llvm-project/build/projects/libc/include/llvm-libc-types/time_t.h:15:24:
note: &#39;time_t&#39; declared here
15 | typedef __INT64_TYPE__ time_t;
|                    ^
</pre></div>
</div>
<p>During the header generation process errors like the one above may occur
because there are missing types for a specific header file. Check the YAML
file corresponding to the header file and make sure all the necessary types
that are being used are input into the types as well. Delete the specific
header file from the build folder and re-run <code class="docutils literal notranslate"><span class="pre">ninja</span> <span class="pre">libc</span></code> to ensure the
types are being recognized.</p>
</li>
<li><p>Test Integration Errors</p>
<p>Sometimes the integration test will fail but that
still means the process is working unless the comparison between the output
and expected_output is not showing. If that is the case make sure in
<code class="docutils literal notranslate"><span class="pre">libc/utils/hdrgen/tests/test_integration.py</span></code> there are no missing arguments
that run through the script.</p>
<p>If the integration tests are failing due to mismatching of lines or small
errors in spacing that is nothing to worry about. If this is happening while
you are making a new change to the formatting of the headers, then
ensure the expected output file
<code class="docutils literal notranslate"><span class="pre">libc/utils/hdrgen/tests/expected_output/test_header.h</span></code> has the changes you
are applying.</p>
</li>
</ol>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">libc</a></h1>








<h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Status &amp; Support</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../headers/index.html">Implementation Status</a></li>
<li class="toctree-l1"><a class="reference internal" href="../arch_support.html">Architecture Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../platform_support.html">Platform Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../compiler_support.html">Compiler Support</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Simple Usage</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../getting_started.html">Getting Started</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Advanced Usage</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../full_host_build.html">Full Host Build</a></li>
<li class="toctree-l1"><a class="reference internal" href="../full_cross_build.html">Full Cross Build</a></li>
<li class="toctree-l1"><a class="reference internal" href="../overlay_mode.html">Overlay Mode</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gpu/index.html">libc for GPUs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../uefi/index.html">libc for UEFI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../configure.html">Configure Options</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Development</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../Maintainers.html">LLVM-libc Maintainers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../build_and_test.html">Building and Testing the libc</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Developer Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../porting.html">Bringup on a New OS or Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing.html">Contributing to the libc Project</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Useful Links</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../talks.html">Talks</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/llvm/llvm-project/tree/main/libc">Source Code</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/llvm/llvm-project/labels/libc">Bug Reports</a></li>
<li class="toctree-l1"><a class="reference external" href="https://discourse.llvm.org/c/runtimes/libc">Discourse</a></li>
<li class="toctree-l1"><a class="reference external" href="https://discord.gg/xS7Z362">Join the Discord</a></li>
<li class="toctree-l1"><a class="reference external" href="https://discord.com/channels/636084430946959380/636732994891284500">Discord Channel</a></li>
<li class="toctree-l1"><a class="reference external" href="https://lab.llvm.org/buildbot/#/builders?tags=libc">Buildbot</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="index.html">Developer Guides</a><ul>
      <li>Previous: <a href="fuzzing.html" title="previous chapter">Fuzzing for LLVM-libc functions</a></li>
      <li>Next: <a href="implementation_standard.html" title="next chapter">Convention for implementing entrypoints</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2011-2025, LLVM Project.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 7.2.6</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 0.7.16</a>
      
      |
      <a href="../_sources/dev/header_generation.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>