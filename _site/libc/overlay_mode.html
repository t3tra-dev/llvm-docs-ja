<!DOCTYPE html>

<html lang="en" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Overlay Mode &#8212; The LLVM C Library</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=d75fae25" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css?v=2e637bd6" />
    <script src="_static/documentation_options.js?v=5929fcd5"></script>
    <script src="_static/doctools.js?v=888ff710"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="libc for GPUs" href="gpu/index.html" />
    <link rel="prev" title="Full Cross Build" href="full_cross_build.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="overlay-mode">
<span id="id1"></span><h1>Overlay Mode<a class="headerlink" href="#overlay-mode" title="Link to this heading">¶</a></h1>
<nav class="contents local" id="table-of-contents">
<p class="topic-title">Table of Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#building-the-libc-in-the-overlay-mode" id="id2">Building the libc in the overlay mode</a></p>
<ul>
<li><p><a class="reference internal" href="#building-llvm-libc-as-a-standalone-runtime" id="id3">Building LLVM-libc as a standalone runtime</a></p></li>
<li><p><a class="reference internal" href="#building-the-static-archive-as-part-of-the-bootstrap-build" id="id4">Building the static archive as part of the bootstrap build</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#using-the-overlay-static-archive" id="id5">Using the overlay static archive</a></p>
<ul>
<li><p><a class="reference internal" href="#linking-the-static-archive-to-other-llvm-binaries" id="id6">Linking the static archive to other LLVM binaries</a></p></li>
</ul>
</li>
</ul>
</nav>
<p>One can choose to use LLVM’s libc in the overlay mode. In this mode, the link
order semantics are exploited to pick symbols from <code class="docutils literal notranslate"><span class="pre">libllvmlibc.a</span></code> (if they
are available in <code class="docutils literal notranslate"><span class="pre">libllvmlibc.a</span></code>) and the rest are picked from the system
libc. The user programs also have to use header files from the system libc.
Naturally, only functions which do not depend on implementation specific ABI
are included in <code class="docutils literal notranslate"><span class="pre">libllvmlibc.a</span></code>. Examples of such functions are <code class="docutils literal notranslate"><span class="pre">strlen</span></code>
and <code class="docutils literal notranslate"><span class="pre">round</span></code>. Functions like <code class="docutils literal notranslate"><span class="pre">fopen</span></code> and friends are not included as they
depend on the implementation specific definition of the <code class="docutils literal notranslate"><span class="pre">FILE</span></code> data structure.</p>
<section id="building-the-libc-in-the-overlay-mode">
<h2><a class="toc-backref" href="#id2" role="doc-backlink">Building the libc in the overlay mode</a><a class="headerlink" href="#building-the-libc-in-the-overlay-mode" title="Link to this heading">¶</a></h2>
<p>There are two different ways in which the libc can be built for use in the
overlay mode. In both the ways, we build a static archive named
<code class="docutils literal notranslate"><span class="pre">libllvmlibc.a</span></code>. We use a rather verbose name with a repeated <code class="docutils literal notranslate"><span class="pre">lib</span></code> to make
it clear that it is not the system libc, which is typically named <code class="docutils literal notranslate"><span class="pre">libc.a</span></code>.
Also, if users choose to mix more than one libc with the system libc, then
the name <code class="docutils literal notranslate"><span class="pre">libllvmlibc.a</span></code> makes it absolutely clear that it is the static
archive of LLVM’s libc.</p>
<section id="building-llvm-libc-as-a-standalone-runtime">
<h3><a class="toc-backref" href="#id3" role="doc-backlink">Building LLVM-libc as a standalone runtime</a><a class="headerlink" href="#building-llvm-libc-as-a-standalone-runtime" title="Link to this heading">¶</a></h3>
<p>We can treat the <code class="docutils literal notranslate"><span class="pre">libc</span></code> project like any other normal LLVM runtime library by
building it with the following cmake command:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$&gt;<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>llvm-project<span class="w">  </span><span class="c1"># The llvm-project checkout</span>
$&gt;<span class="w"> </span>mkdir<span class="w"> </span>build
$&gt;<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>build
$&gt;<span class="w"> </span>cmake<span class="w"> </span>../runtimes<span class="w"> </span>-G<span class="w"> </span>Ninja<span class="w"> </span>-DLLVM_ENABLE_RUNTIMES<span class="o">=</span><span class="s2">&quot;libc&quot;</span><span class="w">  </span><span class="se">\</span>
<span class="w">   </span>-DCMAKE_C_COMPILER<span class="o">=</span>clang<span class="w"> </span>-DCMAKE_CXX_COMPILER<span class="o">=</span>clang++<span class="w"> </span><span class="se">\</span>
<span class="w">   </span>-DCMAKE_BUILD_TYPE<span class="o">=</span>&lt;Debug<span class="p">|</span>Release&gt;<span class="w">                    </span><span class="se">\ </span><span class="w"> </span><span class="c1"># Select build type</span>
<span class="w">   </span>-DCMAKE_INSTALL_PREFIX<span class="o">=</span>&lt;Your<span class="w"> </span>prefix<span class="w"> </span>of<span class="w"> </span>choice&gt;<span class="w">           </span><span class="c1"># Optional</span>
</pre></div>
</div>
<p>Next, build the libc:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$&gt;<span class="w"> </span>ninja<span class="w"> </span>libc
</pre></div>
</div>
<p>Then, run the tests:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$&gt;<span class="w"> </span>ninja<span class="w"> </span>check-libc
</pre></div>
</div>
<p>The build step will build the static archive the in the directory
<code class="docutils literal notranslate"><span class="pre">build/projects/libc/lib</span></code>. Notice that the above CMake configure step also
specified an install prefix. This is optional, but it’s used, then the following
command will install the static archive to the install path:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$&gt;<span class="w"> </span>ninja<span class="w"> </span>install-libc
</pre></div>
</div>
</section>
<section id="building-the-static-archive-as-part-of-the-bootstrap-build">
<h3><a class="toc-backref" href="#id4" role="doc-backlink">Building the static archive as part of the bootstrap build</a><a class="headerlink" href="#building-the-static-archive-as-part-of-the-bootstrap-build" title="Link to this heading">¶</a></h3>
<p>The bootstrap build is a build mode in which runtime components like libc++,
libcxx-abi, libc etc. are built using the ToT clang. The idea is that this build
produces an in-sync toolchain of compiler + runtime libraries. This ensures that
LLVM-libc has access to the latest clang features, which should provide the best
performance possible.</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$&gt;<span class="w"> </span>cmake<span class="w"> </span>../llvm<span class="w"> </span>-G<span class="w"> </span>Ninja<span class="w"> </span>-DLLVM_ENABLE_PROJECTS<span class="o">=</span><span class="s2">&quot;clang&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">   </span>-DLLVM_ENABLE_RUNTIMES<span class="o">=</span><span class="s2">&quot;libc&quot;</span><span class="w">  </span><span class="se">\ </span><span class="w"> </span><span class="c1"># libc is listed as runtime and not as a project</span>
<span class="w">   </span>-DCMAKE_C_COMPILER<span class="o">=</span>clang<span class="w"> </span>-DCMAKE_CXX_COMPILER<span class="o">=</span>clang++<span class="w"> </span><span class="se">\</span>
<span class="w">   </span>-DCMAKE_BUILD_TYPE<span class="o">=</span>&lt;Debug<span class="p">|</span>Release&gt;<span class="w">                    </span><span class="se">\ </span><span class="w"> </span><span class="c1"># Select build type</span>
<span class="w">   </span>-DCMAKE_INSTALL_PREFIX<span class="o">=</span>&lt;Your<span class="w"> </span>prefix<span class="w"> </span>of<span class="w"> </span>choice&gt;<span class="w">           </span><span class="c1"># Optional</span>
</pre></div>
</div>
<p>The build and install steps are the same as above, but the build step will take
much longer since <code class="docutils literal notranslate"><span class="pre">clang</span></code> will be built before building <code class="docutils literal notranslate"><span class="pre">libllvmlibc.a</span></code>.</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$&gt;<span class="w"> </span>ninja<span class="w"> </span>libc
$&gt;<span class="w"> </span>ninja<span class="w"> </span>check-libc
</pre></div>
</div>
</section>
</section>
<section id="using-the-overlay-static-archive">
<h2><a class="toc-backref" href="#id5" role="doc-backlink">Using the overlay static archive</a><a class="headerlink" href="#using-the-overlay-static-archive" title="Link to this heading">¶</a></h2>
<p>Once built (and optionally installed), the overlay static archive can be linked
to your binaries like any other static archive. For example, when building with
<code class="docutils literal notranslate"><span class="pre">clang</span></code> on Linux, one should follow a recipe like:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$&gt;<span class="w"> </span>clang<span class="w"> </span>&lt;other<span class="w"> </span>compiler<span class="w"> </span>and/or<span class="w"> </span>linker<span class="w"> </span>options&gt;<span class="w"> </span>&lt;file.o<span class="p">|</span>c<span class="o">(</span>pp<span class="o">)</span>&gt;<span class="w">     </span><span class="se">\</span>
<span class="w">   </span>-L<span class="w"> </span>&lt;path<span class="w"> </span>to<span class="w"> </span>the<span class="w"> </span>directory<span class="w"> </span><span class="k">in</span><span class="w"> </span>which<span class="w"> </span>libllvmlibc.a<span class="w"> </span>is<span class="w"> </span>installed&gt;<span class="w">  </span><span class="se">\ </span><span class="c1"># Optional</span>
<span class="w">   </span>-lllvmlibc
</pre></div>
</div>
<p>If you installed <code class="docutils literal notranslate"><span class="pre">libllvmlibc.a</span></code> in a standard linker lookup path, for example
<code class="docutils literal notranslate"><span class="pre">/usr/local/lib</span></code> on Linux like systems, then specifying the path to the
static archive using the <code class="docutils literal notranslate"><span class="pre">-L</span></code> option is not necessary.</p>
<section id="linking-the-static-archive-to-other-llvm-binaries">
<h3><a class="toc-backref" href="#id6" role="doc-backlink">Linking the static archive to other LLVM binaries</a><a class="headerlink" href="#linking-the-static-archive-to-other-llvm-binaries" title="Link to this heading">¶</a></h3>
<p>Since the libc and other LLVM binaries are developed in the same source tree,
linking <code class="docutils literal notranslate"><span class="pre">libllvmlibc.a</span></code> to those LLVM binaries does not require any special
install step or explicitly passing any special linker flags/options. One can
simply add <code class="docutils literal notranslate"><span class="pre">llvmlibc</span></code> as a link library to that binary’s target. For example,
if you want to link <code class="docutils literal notranslate"><span class="pre">libllvmlibc.a</span></code> to <code class="docutils literal notranslate"><span class="pre">llvm-objcopy</span></code>, all you have to do
is to add a CMake command as follows:</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">target_link_libraries</span><span class="p">(</span><span class="s">llvm-objcopy</span><span class="w"> </span><span class="s">PRIVATE</span><span class="w"> </span><span class="s">llvmlibc</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">libc</a></h1>








<h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Status &amp; Support</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="headers/index.html">Implementation Status</a></li>
<li class="toctree-l1"><a class="reference internal" href="arch_support.html">Architecture Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="platform_support.html">Platform Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="compiler_support.html">Compiler Support</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Simple Usage</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="getting_started.html">Getting Started</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Advanced Usage</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="full_host_build.html">Full Host Build</a></li>
<li class="toctree-l1"><a class="reference internal" href="full_cross_build.html">Full Cross Build</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Overlay Mode</a></li>
<li class="toctree-l1"><a class="reference internal" href="gpu/index.html">libc for GPUs</a></li>
<li class="toctree-l1"><a class="reference internal" href="uefi/index.html">libc for UEFI</a></li>
<li class="toctree-l1"><a class="reference internal" href="configure.html">Configure Options</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Development</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Maintainers.html">LLVM-libc Maintainers</a></li>
<li class="toctree-l1"><a class="reference internal" href="build_and_test.html">Building and Testing the libc</a></li>
<li class="toctree-l1"><a class="reference internal" href="dev/index.html">Developer Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="porting.html">Bringup on a New OS or Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contributing to the libc Project</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Useful Links</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="talks.html">Talks</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/llvm/llvm-project/tree/main/libc">Source Code</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/llvm/llvm-project/labels/libc">Bug Reports</a></li>
<li class="toctree-l1"><a class="reference external" href="https://discourse.llvm.org/c/runtimes/libc">Discourse</a></li>
<li class="toctree-l1"><a class="reference external" href="https://discord.gg/xS7Z362">Join the Discord</a></li>
<li class="toctree-l1"><a class="reference external" href="https://discord.com/channels/636084430946959380/636732994891284500">Discord Channel</a></li>
<li class="toctree-l1"><a class="reference external" href="https://lab.llvm.org/buildbot/#/builders?tags=libc">Buildbot</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="full_cross_build.html" title="previous chapter">Full Cross Build</a></li>
      <li>Next: <a href="gpu/index.html" title="next chapter">libc for GPUs</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2011-2025, LLVM Project.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 7.2.6</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 0.7.16</a>
      
      |
      <a href="_sources/overlay_mode.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>