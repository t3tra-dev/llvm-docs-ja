<!DOCTYPE html>

<html lang="en" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Full Host Build &#8212; The LLVM C Library</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=d75fae25" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css?v=2e637bd6" />
    <script src="_static/documentation_options.js?v=5929fcd5"></script>
    <script src="_static/doctools.js?v=888ff710"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Full Cross Build" href="full_cross_build.html" />
    <link rel="prev" title="Getting Started" href="getting_started.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="full-host-build">
<span id="id1"></span><h1>Full Host Build<a class="headerlink" href="#full-host-build" title="Link to this heading">¶</a></h1>
<nav class="contents local" id="table-of-contents">
<p class="topic-title">Table of Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#configure-the-build-for-development" id="id3">Configure the build for development</a></p></li>
<li><p><a class="reference internal" href="#build-and-test" id="id4">Build and test</a></p></li>
<li><p><a class="reference internal" href="#configure-the-complete-toolchain-build" id="id5">Configure the complete toolchain build</a></p></li>
<li><p><a class="reference internal" href="#build-and-install" id="id6">Build and install</a></p></li>
<li><p><a class="reference internal" href="#linux-headers" id="id7">Linux Headers</a></p></li>
<li><p><a class="reference internal" href="#using-your-newly-built-libc" id="id8">Using your newly built libc</a></p></li>
</ul>
</nav>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Fullbuild requires running headergen, which is a python program that depends on
pyyaml. The minimum versions are listed on the <a class="reference internal" href="dev/header_generation.html#header-generation"><span class="std std-ref">Generating Public and Internal headers</span></a>
page, as well as additional information.</p>
</div>
<p>In this document, we will present a recipe to build the full libc for the host.
When we say <em>build the libc for the host</em>, the goal is to build the libc for
the same system on which the libc is being built. First, we will explain how to
build for developing LLVM-libc, then we will explain how to build LLVM-libc as
part of a complete toolchain.</p>
<section id="configure-the-build-for-development">
<h2><a class="toc-backref" href="#id3" role="doc-backlink">Configure the build for development</a><a class="headerlink" href="#configure-the-build-for-development" title="Link to this heading">¶</a></h2>
<p>Below is the list of commands for a simple recipe to build LLVM-libc for
development. In this we’ve set the Ninja generator, set the build type to
“Debug”, and enabled the Scudo allocator. This build also enables generating the
documentation and verbose cmake logging, which are useful development features.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>if your build fails with an error saying the compiler can’t find
<code class="docutils literal notranslate"><span class="pre">&lt;asm/unistd.h&gt;</span></code> or similar then you’re probably missing the symlink from
<code class="docutils literal notranslate"><span class="pre">/usr/include/asm</span></code> to <code class="docutils literal notranslate"><span class="pre">/usr/include/&lt;HOST</span> <span class="pre">TRIPLE&gt;/asm</span></code>. Installing the
<code class="docutils literal notranslate"><span class="pre">gcc-multilib</span></code> package creates this symlink, or you can do it manually with
this command:
<code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">ln</span> <span class="pre">-s</span> <span class="pre">/usr/include/&lt;HOST</span> <span class="pre">TRIPLE&gt;/asm</span> <span class="pre">/usr/include/asm</span></code>
(your host triple will probably be similar to <code class="docutils literal notranslate"><span class="pre">x86_64-linux-gnu</span></code>)</p>
</div>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$&gt;<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>llvm-project<span class="w">  </span><span class="c1"># The llvm-project checkout</span>
$&gt;<span class="w"> </span>mkdir<span class="w"> </span>build
$&gt;<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>build
$&gt;<span class="w"> </span>cmake<span class="w"> </span>../runtimes<span class="w"> </span><span class="se">\</span>
<span class="w">   </span>-G<span class="w"> </span>Ninja<span class="w"> </span><span class="se">\</span>
<span class="w">   </span>-DCMAKE_C_COMPILER<span class="o">=</span>clang<span class="w"> </span><span class="se">\</span>
<span class="w">   </span>-DCMAKE_CXX_COMPILER<span class="o">=</span>clang++<span class="w"> </span><span class="se">\</span>
<span class="w">   </span>-DLLVM_ENABLE_RUNTIMES<span class="o">=</span><span class="s2">&quot;libc;compiler-rt&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">   </span>-DLLVM_LIBC_FULL_BUILD<span class="o">=</span>ON<span class="w"> </span><span class="se">\</span>
<span class="w">   </span>-DCMAKE_BUILD_TYPE<span class="o">=</span>Debug<span class="w"> </span><span class="se">\</span>
<span class="w">   </span>-DLLVM_LIBC_INCLUDE_SCUDO<span class="o">=</span>ON<span class="w"> </span><span class="se">\</span>
<span class="w">   </span>-DCOMPILER_RT_BUILD_SCUDO_STANDALONE_WITH_LLVM_LIBC<span class="o">=</span>ON<span class="w"> </span><span class="se">\</span>
<span class="w">   </span>-DCOMPILER_RT_BUILD_GWP_ASAN<span class="o">=</span>OFF<span class="w">                       </span><span class="se">\</span>
<span class="w">   </span>-DCOMPILER_RT_SCUDO_STANDALONE_BUILD_SHARED<span class="o">=</span>OFF<span class="w">        </span><span class="se">\</span>
<span class="w">   </span>-DCMAKE_EXPORT_COMPILE_COMMANDS<span class="o">=</span>ON<span class="w"> </span><span class="se">\</span>
<span class="w">   </span>-DLLVM_ENABLE_SPHINX<span class="o">=</span>ON<span class="w"> </span>-DLIBC_INCLUDE_DOCS<span class="o">=</span>ON<span class="w"> </span><span class="se">\</span>
<span class="w">   </span>-DLIBC_CMAKE_VERBOSE_LOGGING<span class="o">=</span>ON
</pre></div>
</div>
</section>
<section id="build-and-test">
<h2><a class="toc-backref" href="#id4" role="doc-backlink">Build and test</a><a class="headerlink" href="#build-and-test" title="Link to this heading">¶</a></h2>
<p>After configuring the build with the above <code class="docutils literal notranslate"><span class="pre">cmake</span></code> command, one can build test
libc with the following command:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$&gt;<span class="w"> </span>ninja<span class="w"> </span>libc<span class="w"> </span>libm<span class="w"> </span>check-libc
</pre></div>
</div>
<p>To build the docs run this command:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$&gt;<span class="w"> </span>ninja<span class="w"> </span>docs-libc-html
</pre></div>
</div>
<p>To run a specific test, use the following:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$&gt;<span class="w"> </span>ninja<span class="w"> </span>libc.test.src.&lt;HEADER&gt;.&lt;FUNCTION&gt;_test.__unit__
$&gt;<span class="w"> </span>ninja<span class="w"> </span>libc.test.src.ctype.isalpha_test.__unit__<span class="w"> </span><span class="c1"># EXAMPLE</span>
</pre></div>
</div>
</section>
<section id="configure-the-complete-toolchain-build">
<h2><a class="toc-backref" href="#id5" role="doc-backlink">Configure the complete toolchain build</a><a class="headerlink" href="#configure-the-complete-toolchain-build" title="Link to this heading">¶</a></h2>
<p>For a complete toolchain we recommend creating a <em>sysroot</em> (see the documentation
of the <code class="docutils literal notranslate"><span class="pre">--sysroot</span></code> option here:
<a class="reference external" href="https://gcc.gnu.org/onlinedocs/gcc/Directory-Options.html">https://gcc.gnu.org/onlinedocs/gcc/Directory-Options.html</a>) which includes
not only the components of LLVM’s libc, but also a full LLVM only toolchain
consisting of the <a class="reference external" href="https://clang.llvm.org/">clang</a> compiler, the
<a class="reference external" href="https://lld.llvm.org/">lld</a> linker and the
<a class="reference external" href="https://compiler-rt.llvm.org/">compiler-rt</a> runtime libraries. LLVM-libc is
not quite complete enough to allow using and linking a C++ application against
a C++ standard library (like libc++). Hence, we do not include
<a class="reference external" href="https://libcxx.llvm.org/">libc++</a> in the sysroot.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>When the libc is complete enough, we should be able to include
<a class="reference external" href="https://libcxx.llvm.org/">libc++</a>, libcxx-abi and libunwind in the
LLVM only toolchain and use them to build and link C++ applications.</p>
</div>
<p>Below is the cmake command for a bootstrapping build of LLVM. This will build
clang and lld with the current system’s toolchain, then build compiler-rt and
LLVM-libc with that freshly built clang. This ensures that LLVM-libc can take
advantage of the latest clang features and optimizations.</p>
<p>This build also uses Ninja as cmake’s generator, and sets lld and compiler-rt as
the default for the fresh clang. Those settings are recommended, but the build
should still work without them. The compiler-rt options are required for
building <a class="reference external" href="https://llvm.org/docs/ScudoHardenedAllocator.html">Scudo</a> as the
allocator for LLVM-libc.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>if your build fails with an error saying the compiler can’t find
<code class="docutils literal notranslate"><span class="pre">&lt;asm/unistd.h&gt;</span></code> or similar then you’re probably missing the symlink from
<code class="docutils literal notranslate"><span class="pre">/usr/include/asm</span></code> to <code class="docutils literal notranslate"><span class="pre">/usr/include/&lt;TARGET</span> <span class="pre">TRIPLE&gt;/asm</span></code>. Installing the
<code class="docutils literal notranslate"><span class="pre">gcc-multilib</span></code> package creates this symlink, or you can do it manually with
this command:
<code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">ln</span> <span class="pre">-s</span> <span class="pre">/usr/include/&lt;TARGET</span> <span class="pre">TRIPLE&gt;/asm</span> <span class="pre">/usr/include/asm</span></code></p>
</div>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$&gt;<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>llvm-project<span class="w">  </span><span class="c1"># The llvm-project checkout</span>
$&gt;<span class="w"> </span>mkdir<span class="w"> </span>build
$&gt;<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>build
$&gt;<span class="w"> </span><span class="nv">SYSROOT</span><span class="o">=</span>/path/to/sysroot<span class="w"> </span><span class="c1"># Remember to set this!</span>
$&gt;<span class="w"> </span>cmake<span class="w"> </span>../llvm<span class="w">  </span><span class="se">\</span>
<span class="w">   </span>-G<span class="w"> </span>Ninja<span class="w">  </span><span class="se">\</span>
<span class="w">   </span>-DLLVM_ENABLE_PROJECTS<span class="o">=</span><span class="s2">&quot;clang;lld&quot;</span><span class="w">   </span><span class="se">\</span>
<span class="w">   </span>-DLLVM_ENABLE_RUNTIMES<span class="o">=</span><span class="s2">&quot;libc;compiler-rt&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">   </span>-DCMAKE_BUILD_TYPE<span class="o">=</span>Release<span class="w">  </span><span class="se">\</span>
<span class="w">   </span>-DCMAKE_C_COMPILER<span class="o">=</span>clang<span class="w"> </span><span class="se">\</span>
<span class="w">   </span>-DCMAKE_CXX_COMPILER<span class="o">=</span>clang++<span class="w"> </span><span class="se">\</span>
<span class="w">   </span>-DLLVM_LIBC_FULL_BUILD<span class="o">=</span>ON<span class="w"> </span><span class="se">\</span>
<span class="w">   </span>-DLLVM_LIBC_INCLUDE_SCUDO<span class="o">=</span>ON<span class="w"> </span><span class="se">\</span>
<span class="w">   </span>-DCOMPILER_RT_BUILD_SCUDO_STANDALONE_WITH_LLVM_LIBC<span class="o">=</span>ON<span class="w"> </span><span class="se">\</span>
<span class="w">   </span>-DCOMPILER_RT_BUILD_GWP_ASAN<span class="o">=</span>OFF<span class="w">                       </span><span class="se">\</span>
<span class="w">   </span>-DCOMPILER_RT_SCUDO_STANDALONE_BUILD_SHARED<span class="o">=</span>OFF<span class="w">        </span><span class="se">\</span>
<span class="w">   </span>-DCLANG_DEFAULT_LINKER<span class="o">=</span>lld<span class="w"> </span><span class="se">\</span>
<span class="w">   </span>-DCLANG_DEFAULT_RTLIB<span class="o">=</span>compiler-rt<span class="w"> </span><span class="se">\</span>
<span class="w">   </span>-DCMAKE_INSTALL_PREFIX<span class="o">=</span><span class="nv">$SYSROOT</span>
</pre></div>
</div>
</section>
<section id="build-and-install">
<h2><a class="toc-backref" href="#id6" role="doc-backlink">Build and install</a><a class="headerlink" href="#build-and-install" title="Link to this heading">¶</a></h2>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Running these install commands without setting a <code class="docutils literal notranslate"><span class="pre">$SYSROOT</span></code> will install
them into your system include path, which may break your system. If you’re
just trying to develop libc, then just run <code class="docutils literal notranslate"><span class="pre">ninja</span> <span class="pre">check-libc</span></code> to build the
libc and run the tests. If you’ve already accidentally installed the headers,
you may need to delete them from <code class="docutils literal notranslate"><span class="pre">/usr/local/include</span></code>.</p>
</div>
<p>After configuring the build with the above <code class="docutils literal notranslate"><span class="pre">cmake</span></code> command, one can build and
install the toolchain with</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$&gt;<span class="w"> </span>ninja<span class="w"> </span>install-clang<span class="w"> </span>install-builtins<span class="w"> </span>install-compiler-rt<span class="w">  </span><span class="se">\</span>
<span class="w">   </span>install-core-resource-headers<span class="w"> </span>install-libc<span class="w"> </span>install-lld
</pre></div>
</div>
<p>or</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$&gt;<span class="w"> </span>ninja<span class="w"> </span>install
</pre></div>
</div>
<p>Once the above command completes successfully, the <code class="docutils literal notranslate"><span class="pre">$SYSROOT</span></code> directory you
have specified with the CMake configure step above will contain a full LLVM-only
toolchain with which you can build practical/real-world C applications. See
<a class="reference external" href="https://github.com/llvm/llvm-project/tree/main/libc/examples">https://github.com/llvm/llvm-project/tree/main/libc/examples</a> for examples
of how to start using this new toolchain.</p>
</section>
<section id="linux-headers">
<h2><a class="toc-backref" href="#id7" role="doc-backlink">Linux Headers</a><a class="headerlink" href="#linux-headers" title="Link to this heading">¶</a></h2>
<p>If you are using the full libc on Linux, then you will also need to install
Linux headers in your sysroot.  Let’s build them from source.</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$&gt;<span class="w"> </span>git<span class="w"> </span>clone<span class="w"> </span>--depth<span class="o">=</span><span class="m">1</span><span class="w"> </span>git://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git<span class="w"> </span>/tmp/linux
$&gt;<span class="w"> </span>make<span class="w"> </span><span class="nv">LLVM</span><span class="o">=</span><span class="m">1</span><span class="w"> </span><span class="nv">INSTALL_HDR_PATH</span><span class="o">=</span>/path/to/sysroot<span class="w"> </span>-C<span class="w"> </span>/tmp/linux<span class="w"> </span>headers_install
</pre></div>
</div>
<p>The headers can be built to target non-host architectures by adding the
<code class="docutils literal notranslate"><span class="pre">ARCH={arm|arm64|i386}</span></code> to the above invocation of <code class="docutils literal notranslate"><span class="pre">make</span></code>.</p>
</section>
<section id="using-your-newly-built-libc">
<h2><a class="toc-backref" href="#id8" role="doc-backlink">Using your newly built libc</a><a class="headerlink" href="#using-your-newly-built-libc" title="Link to this heading">¶</a></h2>
<p>You can now use your newly built libc nearly like you would use any compiler
invocation:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$&gt;<span class="w"> </span>/path/to/sysroot/bin/clang<span class="w"> </span>-static<span class="w"> </span>main.c
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Because the libc does not yet support dynamic linking, the -static parameter
must be added to all clang invocations.</p>
</div>
<p>You can make sure you’re using the newly built toolchain by trying out features
that aren’t yet supported by the system toolchain, such as fixed point. The
following is an example program that demonstrates the difference:</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="c1">// $ $SYSROOT/bin/clang example.c -static -ffixed-point --sysroot=$SYSROOT</span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">   </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Hello, World!</span><span class="se">\n</span><span class="s">%.9f</span><span class="se">\n</span><span class="s">%.9lK</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="mf">4294967295.000000001</span><span class="p">,</span>
<span class="w">      </span><span class="mf">4294967295.000000001</span><span class="n">ulK</span><span class="p">);</span>
<span class="w">   </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">libc</a></h1>








<h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Status &amp; Support</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="headers/index.html">Implementation Status</a></li>
<li class="toctree-l1"><a class="reference internal" href="arch_support.html">Architecture Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="platform_support.html">Platform Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="compiler_support.html">Compiler Support</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Simple Usage</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="getting_started.html">Getting Started</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Advanced Usage</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Full Host Build</a></li>
<li class="toctree-l1"><a class="reference internal" href="full_cross_build.html">Full Cross Build</a></li>
<li class="toctree-l1"><a class="reference internal" href="overlay_mode.html">Overlay Mode</a></li>
<li class="toctree-l1"><a class="reference internal" href="gpu/index.html">libc for GPUs</a></li>
<li class="toctree-l1"><a class="reference internal" href="uefi/index.html">libc for UEFI</a></li>
<li class="toctree-l1"><a class="reference internal" href="configure.html">Configure Options</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Development</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Maintainers.html">LLVM-libc Maintainers</a></li>
<li class="toctree-l1"><a class="reference internal" href="build_and_test.html">Building and Testing the libc</a></li>
<li class="toctree-l1"><a class="reference internal" href="dev/index.html">Developer Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="porting.html">Bringup on a New OS or Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contributing to the libc Project</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Useful Links</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="talks.html">Talks</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/llvm/llvm-project/tree/main/libc">Source Code</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/llvm/llvm-project/labels/libc">Bug Reports</a></li>
<li class="toctree-l1"><a class="reference external" href="https://discourse.llvm.org/c/runtimes/libc">Discourse</a></li>
<li class="toctree-l1"><a class="reference external" href="https://discord.gg/xS7Z362">Join the Discord</a></li>
<li class="toctree-l1"><a class="reference external" href="https://discord.com/channels/636084430946959380/636732994891284500">Discord Channel</a></li>
<li class="toctree-l1"><a class="reference external" href="https://lab.llvm.org/buildbot/#/builders?tags=libc">Buildbot</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="getting_started.html" title="previous chapter">Getting Started</a></li>
      <li>Next: <a href="full_cross_build.html" title="next chapter">Full Cross Build</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2011-2025, LLVM Project.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 7.2.6</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 0.7.16</a>
      
      |
      <a href="_sources/full_host_build.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>